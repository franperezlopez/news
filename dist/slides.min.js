const CONFIG={dataUrl:"docs/slide_new.yaml",assetBasePath:"data/assets/slide_2025_50/",tabBarAutoHideDelay:3e3,tabBarDimmedDuration:800,onboardingDuration:4e3,sessionTabBarDelay:2e3,storageKeys:{mode:"newsletterViewerMode",onboarded:"newsletterViewerOnboarded",selectedTags:"newsletterSelectedTags"},sectionMap:{news:0,models:1,papers:2,blogs:3,opinion:4,exit:5}};window.SLIDE_CONFIG&&Object.assign(CONFIG,window.SLIDE_CONFIG);const VISUAL_PRIMITIVES={durations:{withinPost:150,betweenPosts:150,betweenGroups:250,betweenSections:400,microSettle:25,edgeFlash:200,sheen:250,axisHint:400,depthSwap:400,overlay:400},brightness:{neutral:1,postDimmed:.9,bundleDimmed:.8,sectionDimmed:.6},scale:{bundleStart:.98,sectionStart:.96},motion:{axisHintDrift:3,sheenWidth:120},easing:{default:"cubic-bezier(0.16, 1, 0.3, 1)",settle:"cubic-bezier(0.22, 1, 0.36, 1)",section:"cubic-bezier(0.65, 0, 0.35, 1)",spring:"cubic-bezier(0.34, 1.56, 0.64, 1)"}};function getTransitionDuration(e){return{withinPost:VISUAL_PRIMITIVES.durations.withinPost,betweenPosts:VISUAL_PRIMITIVES.durations.betweenPosts,betweenGroups:VISUAL_PRIMITIVES.durations.betweenGroups,section:VISUAL_PRIMITIVES.durations.betweenSections,sectionHorizontal:VISUAL_PRIMITIVES.durations.betweenSections}[e]||VISUAL_PRIMITIVES.durations.withinPost}const state={newsletter:null,currentSlideIndex:0,allSlides:[],visibleSlides:[],mode:"all",allTags:new Set,newTags:new Set,selectedTags:new Set,tagPanelVisible:!1,tabBarVisible:!1,tabBarTimeout:null,tabBarHovered:!1,isAnimating:!1,activeVideoIndex:null,bundleStack:[],currentBundleId:null,touchStartX:0,touchStartY:0,touchStartTime:0},dom={tabBar:null,tabs:null,modeToggle:null,modeAllBtn:null,modePersonalizedBtn:null,filterButton:null,tagPanel:null,tagCloud:null,progressFill:null,progressSections:null,slideContainer:null,slideTrack:null,navPrev:null,navNext:null,edgeFlashLeft:null,edgeFlashRight:null,sheenLeft:null,sheenRight:null,sectionOverlay:null,topTrigger:null,onboarding:null,errorState:null,loadingState:null,currentSlideCounter:null,totalSlidesCounter:null};async function init(){cacheDOMReferences();try{await loadNewsletter(),buildSlideIndex(),buildTagIndex(),generateTabBar(),cacheDOMReferences(),restoreState(),renderSlides(),renderTagCloud(),updateUI(),bindEvents(),handleInitialState(),hideLoading()}catch(e){console.error("Failed to initialize viewer:",e),showError(e.message)}}function cacheDOMReferences(){dom.tabBar=document.getElementById("tab-bar"),dom.tabs=document.querySelectorAll("#tabs-container .tab"),dom.modeToggle=document.getElementById("mode-toggle"),dom.modeAllBtn=document.getElementById("mode-all"),dom.modePersonalizedBtn=document.getElementById("mode-personalized"),dom.filterButton=document.getElementById("filter-button"),dom.tagPanel=document.getElementById("tag-panel"),dom.tagCloud=document.getElementById("tag-cloud"),dom.progressFill=document.querySelector(".progress-fill"),dom.progressSections=document.querySelector(".progress-sections"),dom.slideContainer=document.getElementById("slide-container"),dom.slideTrack=document.getElementById("slide-track"),dom.navPrev=document.getElementById("nav-prev"),dom.navNext=document.getElementById("nav-next"),dom.edgeFlashLeft=document.getElementById("edge-flash-left"),dom.edgeFlashRight=document.getElementById("edge-flash-right"),dom.sectionOverlay=document.getElementById("section-overlay"),dom.topTrigger=document.getElementById("top-trigger"),dom.onboarding=document.getElementById("onboarding"),dom.errorState=document.getElementById("error-state"),dom.loadingState=document.getElementById("loading-state"),dom.currentSlideCounter=document.getElementById("current-slide"),dom.totalSlidesCounter=document.getElementById("total-slides"),createSheenElements()}function createSheenElements(){dom.sheenLeft=document.createElement("div"),dom.sheenLeft.id="sheen-left",dom.sheenLeft.className="sheen left",document.body.appendChild(dom.sheenLeft),dom.sheenRight=document.createElement("div"),dom.sheenRight.id="sheen-right",dom.sheenRight.className="sheen right",document.body.appendChild(dom.sheenRight)}async function loadNewsletter(){const e=await fetch(CONFIG.dataUrl);if(!e.ok)throw new Error(`Failed to fetch newsletter data: ${e.status}`);const t=await e.text(),s=jsyaml.load(t);if(!s||!s.newsletter)throw new Error("Invalid newsletter data format");return s.newsletter.sections||(s.newsletter.sections=[]),state.newsletter=s.newsletter,state.newsletter}function generateTabBar(){const e={};state.allSlides.forEach(t=>{e[t.sectionKey]||(e[t.sectionKey]=t.sectionName)});const t=document.getElementById("tabs-container");t.innerHTML="";Object.keys(CONFIG.sectionMap).forEach(s=>{if(e[s]){const a=e[s],n=document.createElement("button");n.className="tab",n.dataset.section=s,n.innerHTML=`\n        <span class="tab-name">${a}</span>\n        <span class="tab-badge">0</span>\n      `,t.appendChild(n)}})}function buildSlideIndex(){const e=[];let t=0;state.newsletter.sections.forEach((s,a)=>{if(!s||!s.name)return;const n=s.name.toLowerCase();s.items?.forEach((i,o)=>{const d=void 0!==i.items;if(void 0!==i.assets){const d=t,l=i.assets?.length||0;i.assets?.forEach((r,c)=>{let u=r.source;u.startsWith("assets/")&&(u=u.slice(7)),e.push({sectionIndex:a,sectionName:s.name,sectionKey:n,groupIndex:null,postIndex:o,postId:i.id,postUrl:r.url||i.url,assetIndex:c,asset:{...r,source:CONFIG.assetBasePath+u},globalIndex:t,postStartIndex:d,postEndIndex:d+l-1,isHighlight:r.tags?.includes("highlight")??!1}),t++})}else if(d){const d=o;i.items?.forEach((i,o)=>{const l=t,r=i.assets?.length||0;i.assets?.forEach((c,u)=>{let g=c.source;g.startsWith("assets/")&&(g=g.slice(7)),e.push({sectionIndex:a,sectionName:s.name,sectionKey:n,groupIndex:d,postIndex:o,postId:i.id,postUrl:c.url||i.url,assetIndex:u,asset:{...c,source:CONFIG.assetBasePath+g},globalIndex:t,postStartIndex:l,postEndIndex:l+r-1,isHighlight:c.tags?.includes("highlight")??!1}),t++})})}})});const s=CONFIG.sectionMap.exit;e.push({sectionIndex:s,sectionName:"Exit",sectionKey:"exit",groupIndex:null,postIndex:0,postId:"exit",postUrl:null,assetIndex:0,asset:{type:"html",html:'\n        <div class="exit-slide-content">\n          <div class="exit-slide-inner">\n            <img src="assets/qr.png" alt="QR Code" class="exit-qr-code" />\n            <div class="exit-message">\n              <p class="exit-label">ðŸ“š <a href="index_all.html"><strong>view all previous issues</strong></a></p>\n              <p class="exit-tagline">âœ¨ see you next week!</p>\n            </div>\n          </div>\n        </div>\n      '},globalIndex:t,postStartIndex:t,postEndIndex:t,isHighlight:!1}),state.allSlides=e,updateVisibleSlides()}function updateVisibleSlides(){"personalized"===state.mode&&state.selectedTags.size>0?(state.visibleSlides=state.allSlides.filter(e=>{const t=getSlideTagsSet(e);for(const e of state.selectedTags)if(t.has(e))return!0;return!1}),0===state.visibleSlides.length&&(state.visibleSlides=[...state.allSlides])):state.visibleSlides=[...state.allSlides]}function isLastVideoInGroup(e,t){if(null===e.groupIndex)return!1;for(let s=t+1;s<state.visibleSlides.length;s++){const t=state.visibleSlides[s];if(t.sectionIndex!==e.sectionIndex||t.groupIndex!==e.groupIndex)break;if("video"===t.asset.type)return!1}return!0}function findGroupEndIndex(e,t){let s=t;for(let a=t+1;a<state.visibleSlides.length;a++){const t=state.visibleSlides[a];if(t.sectionIndex!==e.sectionIndex||t.groupIndex!==e.groupIndex)break;s=a}return s}function calculateVideoEndIndex(e,t){let s=e.postEndIndex;return isLastVideoInGroup(e,t)&&(s=findGroupEndIndex(e,t)),s}function findActiveVideoForSlide(e){const t=state.visibleSlides[e];if(!t)return null;if("video"===t.asset.type)return e;for(let t=e-1;t>=0;t--){const s=state.visibleSlides[t];if("video"===s.asset.type){const a=calculateVideoEndIndex(s,t);return e>=t&&e<=a?t:null}}return null}function buildTagIndex(){state.allTags=new Set,state.newTags=new Set,state.newsletter.new_tags&&Array.isArray(state.newsletter.new_tags)&&state.newsletter.new_tags.forEach(e=>{state.newTags.add(e.toLowerCase())}),state.allSlides.forEach(e=>{e.asset.tags&&Array.isArray(e.asset.tags)&&e.asset.tags.forEach(e=>{state.allTags.add(e.toLowerCase())})})}function renderTagCloud(){if(!dom.tagCloud)return;dom.tagCloud.innerHTML="";Array.from(state.allTags).sort().forEach(e=>{const t=document.createElement("button");t.className="tag-chip",t.dataset.tag=e,t.textContent=e,t.setAttribute("role","checkbox"),t.setAttribute("aria-checked","false"),state.newTags.has(e)&&t.classList.add("new"),state.selectedTags.has(e)&&(t.classList.add("selected"),t.setAttribute("aria-checked","true")),t.addEventListener("click",()=>toggleTag(e)),dom.tagCloud.appendChild(t)}),updateTagChipPresentState()}function updateTagChipPresentState(){if(!dom.tagCloud)return;const e=state.visibleSlides[state.currentSlideIndex],t=new Set;e?.asset?.tags&&e.asset.tags.forEach(e=>t.add(e.toLowerCase()));dom.tagCloud.querySelectorAll(".tag-chip").forEach(e=>{const s=e.dataset.tag;e.classList.toggle("present",t.has(s))})}function toggleTag(e){state.selectedTags.has(e)?state.selectedTags.delete(e):state.selectedTags.add(e);const t=dom.tagCloud.querySelector(`[data-tag="${e}"]`);t&&(t.classList.toggle("selected",state.selectedTags.has(e)),t.setAttribute("aria-checked",state.selectedTags.has(e)?"true":"false"))}function toggleTagPanel(){state.tagPanelVisible=!state.tagPanelVisible,dom.tagPanel.classList.toggle("visible",state.tagPanelVisible),dom.filterButton.classList.toggle("active",state.tagPanelVisible),state.tagPanelVisible?(clearTimeout(state.tabBarTimeout),showTabBar(!1)):(saveSelectedTags(),"personalized"===state.mode&&applyTagFilter(),state.tabBarHovered||(clearTimeout(state.tabBarTimeout),state.tabBarTimeout=setTimeout(()=>{hideTabBar()},CONFIG.tabBarAutoHideDelay)))}function closeTagPanel(){state.tagPanelVisible&&toggleTagPanel()}function applyTagFilter(){clearBundleStack();const e=state.visibleSlides[state.currentSlideIndex]?.globalIndex;if(updateVisibleSlides(),void 0!==e&&state.visibleSlides.length>0){let t=state.visibleSlides.findIndex(t=>t.globalIndex===e);-1===t&&(t=state.visibleSlides.findIndex(t=>t.globalIndex>e),-1===t&&(t=state.visibleSlides.length-1)),state.currentSlideIndex=Math.max(0,t)}else state.currentSlideIndex=0;renderSlides(),updateUI()}function getSlideTagsSet(e){const t=new Set;return e?.asset?.tags&&e.asset.tags.forEach(e=>t.add(e.toLowerCase())),t}function restoreState(){const e=localStorage.getItem(CONFIG.storageKeys.mode);"all"!==e&&"personalized"!==e||(state.mode=e);const t=localStorage.getItem(CONFIG.storageKeys.selectedTags);if(t)try{const e=JSON.parse(t);state.selectedTags=new Set(e)}catch(e){console.warn("Failed to restore selected tags:",e),state.selectedTags=new Set}updateVisibleSlides();const s=window.location.hash.slice(1);if(s){const e=findSlideFromHash(s);-1!==e&&(state.currentSlideIndex=e)}state.visibleSlides.length>0?state.currentSlideIndex=Math.max(0,Math.min(state.currentSlideIndex,state.visibleSlides.length-1)):state.currentSlideIndex=0}function findSlideFromHash(e){const t=e.split("/");if(2!==t.length)return-1;const[s,a]=t,n=parseInt(a,10);if(isNaN(n))return-1;let i=0;return state.visibleSlides.findIndex(e=>{if(e.sectionKey===s){if(i===n)return!0;i++}return!1})}function updateURLHash(){const e=state.visibleSlides[state.currentSlideIndex];if(!e)return;let t=0;for(let s=0;s<state.currentSlideIndex;s++)state.visibleSlides[s].sectionKey===e.sectionKey&&t++;const s=`${e.sectionKey}/${t}`;history.replaceState(null,"",`#${s}`)}function saveMode(){localStorage.setItem(CONFIG.storageKeys.mode,state.mode)}function saveSelectedTags(){const e=Array.from(state.selectedTags);localStorage.setItem(CONFIG.storageKeys.selectedTags,JSON.stringify(e))}function renderSlides(){dom.slideTrack.innerHTML="",state.visibleSlides.forEach((e,t)=>{const s=createSlideElement(e,t);dom.slideTrack.appendChild(s)}),updateActiveSlide(),renderProgressSections()}function createSlideElement(e,t){const s=document.createElement("div");if(s.className="slide",s.dataset.index=t,"html"===e.asset.type){const t=document.createElement("div");t.innerHTML=e.asset.html,s.appendChild(t)}else if("video"===e.asset.type){const t=document.createElement("video");t.src=e.asset.source,t.loop=!0,t.muted=!1,t.playsInline=!0,t.preload="metadata",t.addEventListener("click",()=>openPostUrl(e.postUrl)),s.appendChild(t)}else{const t=document.createElement("img");t.src=e.asset.source,t.alt=e.asset.alt||"",t.loading="lazy",t.addEventListener("click",()=>openPostUrl(e.postUrl)),t.onerror=()=>{t.style.display="none";const e=document.createElement("div");e.className="slide-placeholder",e.innerHTML='\n        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">\n          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>\n          <circle cx="8.5" cy="8.5" r="1.5"/>\n          <polyline points="21 15 16 10 5 21"/>\n        </svg>\n        <span>Asset not found</span>\n      ',s.appendChild(e)},s.appendChild(t)}return s}function openPostUrl(e){e&&window.open(e,"_blank","noopener,noreferrer")}function renderProgressSections(){dom.progressSections.innerHTML="";const e={};state.visibleSlides.forEach(t=>{const s=t.sectionKey;e[s]=(e[s]||0)+1});const t=state.visibleSlides.length;["news","models","papers","blogs","opinion","exit"].forEach(s=>{if(e[s]){const a=e[s]/t*100,n=document.createElement("div");n.className="progress-section",n.style.width=`${a}%`,n.dataset.section=s,dom.progressSections.appendChild(n)}})}function getBundleId(e){return e&&null!==e.groupIndex?`${e.sectionIndex}-${e.groupIndex}`:null}function isInSameBundle(e,t){if(!e||!t)return!1;const s=getBundleId(e),a=getBundleId(t);return null!==s&&s===a}function isInBundle(e){return e&&null!==e.groupIndex}function clearBundleStack(){state.bundleStack.forEach(e=>{const t=dom.slideTrack.querySelector(`[data-index="${e}"]`);t&&(t.classList.add("stack-fade-out"),setTimeout(()=>{t.classList.remove("stacked","stack-fade-out","stack-depth-2","stack-depth-3","stack-depth-4")},200))}),state.bundleStack=[],state.currentBundleId=null}function pushToStack(e){state.bundleStack.push(e),updateStackDepths()}function popFromStack(){if(0===state.bundleStack.length)return null;const e=state.bundleStack.pop(),t=dom.slideTrack.querySelector(`[data-index="${e}"]`);return t&&t.classList.remove("stacked","stack-depth-2","stack-depth-3","stack-depth-4"),updateStackDepths(),e}function updateStackDepths(){const e=state.bundleStack.length;state.bundleStack.forEach((t,s)=>{const a=dom.slideTrack.querySelector(`[data-index="${t}"]`);if(!a)return;const n=e-1-s;a.classList.add("stacked"),a.classList.remove("stack-depth-2","stack-depth-3","stack-depth-4","prev","next"),1===n?a.classList.add("stack-depth-2"):2===n?a.classList.add("stack-depth-3"):n>=3&&a.classList.add("stack-depth-4")})}function isInCurrentStack(e){return state.bundleStack.includes(e)}function navigateHorizontal(e){if(state.isAnimating||0===state.visibleSlides.length)return;const t=state.currentSlideIndex,s="next"===e?Math.min(t+1,state.visibleSlides.length-1):Math.max(t-1,0);if(s===t)return;const a=state.visibleSlides[t],n=state.visibleSlides[s];let i="withinPost",o=null;a.sectionIndex!==n.sectionIndex?(i="sectionHorizontal",o="clear"):a.groupIndex!==n.groupIndex?(i="betweenGroups",o="clear"):a.postIndex!==n.postIndex&&(i="betweenPosts",isInBundle(a)&&(o=isInCurrentStack(s)?"pop":"push"));const d=getBundleId(n);d&&state.currentBundleId!==d&&(state.bundleStack.length>0&&clearBundleStack(),state.currentBundleId=d),goToSlide(s,e,i,o)}function navigateVertical(e){if(state.isAnimating||0===state.visibleSlides.length)return;const t=state.visibleSlides[state.currentSlideIndex];if(!t)return;const s=t.sectionIndex;let a=s,n=!1;if("next"===e){const e=Object.keys(CONFIG.sectionMap).length-1;for(let t=s+1;t<=e;t++){if(state.visibleSlides.find(e=>e.sectionIndex===t)){a=t,n=!0;break}}}else for(let e=s-1;e>=0;e--){if(state.visibleSlides.find(t=>t.sectionIndex===e)){a=e,n=!0;break}}if(!n)return;const i=state.visibleSlides.findIndex(e=>e.sectionIndex===a);-1!==i&&goToSlide(i,e,"section","clear")}function goToSection(e){if(state.isAnimating)return;const t=state.visibleSlides.findIndex(t=>t.sectionKey===e);if(-1===t||t===state.currentSlideIndex)return;goToSlide(t,t>state.currentSlideIndex?"next":"prev","section","clear")}function goToSlide(e,t,s="withinPost",a=null){if(e<0||e>=state.visibleSlides.length)return;if(state.isAnimating)return;state.isAnimating=!0;const n=dom.slideTrack.querySelector(`[data-index="${state.currentSlideIndex}"]`),i=dom.slideTrack.querySelector(`[data-index="${e}"]`),o=null!==state.activeVideoIndex&&state.activeVideoIndex!==state.currentSlideIndex?dom.slideTrack.querySelector(`[data-index="${state.activeVideoIndex}"]`):null;if(!n||!i)return void(state.isAnimating=!1);"clear"===a&&clearBundleStack();const d=getTransitionDuration(s);updateVideoStates(e),"pop"===a?executeStackPopTransition(n,i,t,d):"push"===a?executeStackPushTransition(n,i,t,d):(applyTransitionEffects(n,i,s,t),"section"===s?executeVerticalTransition(n,i,t,o):"sectionHorizontal"===s?executeHorizontalSectionTransition(n,i,t,o):executeHorizontalTransition(n,i,s,t,o)),state.currentSlideIndex=e,scheduleTransitionCleanup(n,i,d),updateUI(),updateURLHash()}function applyTransitionEffects(e,t,s,a){const n=["transition-within-post","transition-posts","transition-groups","transition-section","transition-section-horizontal","direction-backward","transitioning-out","micro-settle","depth-swap","axis-hint-up","axis-hint-down","scale-enter"];switch(e.classList.remove(...n),t.classList.remove(...n),s){case"withinPost":e.classList.add("transition-within-post"),t.classList.add("transition-within-post");break;case"betweenPosts":e.classList.add("transition-posts","transitioning-out"),t.classList.add("transition-posts","micro-settle"),flashEdge(a);break;case"betweenGroups":e.classList.add("transition-groups","transitioning-out"),t.classList.add("transition-groups","scale-enter"),triggerGroupTransitionEffects(a);break;case"sectionHorizontal":e.classList.add("transition-section-horizontal","transitioning-out"),t.classList.add("transition-section-horizontal"),t.classList.add("next"===a?"axis-hint-up":"axis-hint-down"),triggerSectionTransitionEffects(),showTabBar(!1);break;case"section":e.classList.add("transition-section","transitioning-out"),t.classList.add("transition-section","depth-swap"),triggerSectionTransitionEffects(),showTabBar(!1)}"prev"===a&&(e.classList.add("direction-backward"),t.classList.add("direction-backward"))}function triggerSectionTransitionEffects(){dom.sectionOverlay&&(dom.sectionOverlay.classList.add("active"),setTimeout(()=>{dom.sectionOverlay.classList.remove("active")},VISUAL_PRIMITIVES.durations.overlay)),setTimeout(()=>{pulseActiveTab()},.3*VISUAL_PRIMITIVES.durations.overlay)}function pulseActiveTab(){const e=document.querySelector(".tab.active");e&&(e.classList.remove("transitioning"),e.offsetWidth,e.classList.add("transitioning"),setTimeout(()=>{e.classList.remove("transitioning")},400))}function executeVerticalTransition(e,t,s,a){t.classList.add("next"===s?"section-enter-from-bottom":"section-enter-from-top"),t.classList.remove("prev","next"),a&&a!==e&&(a.classList.remove("video-background","active"),a.classList.add("prev")),requestAnimationFrame(()=>{e.classList.remove("active"),e.classList.add("next"===s?"section-exit-up":"section-exit-down"),t.classList.add("active"),requestAnimationFrame(()=>{t.classList.remove("section-enter-from-bottom","section-enter-from-top")})})}function executeHorizontalSectionTransition(e,t,s,a){a&&a!==e&&(a.classList.remove("video-background","active"),a.classList.add("next"===s?"prev":"next")),e.classList.contains("video-background")||(e.classList.remove("active"),e.classList.add("next"===s?"prev":"next")),t.classList.remove("prev","next"),t.classList.add("active")}function executeHorizontalTransition(e,t,s,a,n){const i=n&&t===n;"betweenGroups"===s&&n&&(n.classList.remove("video-background","active"),n.classList.add("next"===a?"prev":"next")),e.classList.remove("active"),e.classList.add("next"===a?"prev":"next"),i?t.classList.remove("video-background","prev","next"):t.classList.remove("prev","next"),t.classList.add("active")}function executeStackPushTransition(e,t,s,a){pushToStack(parseInt(e.dataset.index)),e.classList.remove("active"),e.classList.add("stack-top"),t.classList.remove("prev","next","stacked"),t.classList.add("active","stack-top"),flashEdge(s),setTimeout(()=>{e.classList.remove("stack-top"),t.classList.remove("stack-top")},a)}function executeStackPopTransition(e,t,s,a){popFromStack(),e.classList.remove("active"),e.classList.add("next"===s?"prev":"next"),t.classList.remove("stacked","stack-depth-2","stack-depth-3","stack-depth-4","prev","next"),t.classList.add("active","unstacking"),setTimeout(()=>{t.classList.remove("unstacking")},a)}function triggerGroupTransitionEffects(e){flashEdge(e),triggerSheen(e)}function triggerSheen(e){const t="next"===e?dom.sheenRight:dom.sheenLeft;t&&(t.classList.remove("flash"),t.offsetWidth,t.classList.add("flash"))}function scheduleTransitionCleanup(e,t,s){const a=t.classList.contains("micro-settle")?VISUAL_PRIMITIVES.durations.microSettle:0;setTimeout(()=>{const s=["section-exit-up","section-exit-down","transitioning-out","transitioning-in","transition-within-post","transition-posts","transition-groups","transition-section","transition-section-horizontal","direction-backward","micro-settle","depth-swap","axis-hint-up","axis-hint-down","scale-enter","stack-top","unstacking"];e.classList.contains("video-background")?e.classList.remove("transitioning-out","transitioning-in","transition-posts","transition-groups","direction-backward"):e.classList.remove(...s),t.classList.remove(...s),state.isAnimating=!1},s+a)}function updateActiveSlide(){dom.slideTrack.querySelectorAll(".slide").forEach((e,t)=>{e.classList.remove("active","prev","next","video-background"),t===state.currentSlideIndex?e.classList.add("active"):t<state.currentSlideIndex?e.classList.add("prev"):e.classList.add("next")}),updateVideoStates(state.currentSlideIndex)}function updateVideoStates(e){const t=findActiveVideoForSlide(e),s=state.activeVideoIndex;if(null!==s&&s!==t&&stopVideo(s),state.activeVideoIndex=t,null!==t){const s=dom.slideTrack.querySelector(`[data-index="${t}"]`),a=s?.querySelector("video");a&&(e===t?(s.classList.remove("video-background"),a.paused&&(a.muted=!1,a.play().catch(()=>{}))):(s.classList.add("video-background","active"),a.paused&&(a.muted=!1,a.play().catch(()=>{}))))}}function stopVideo(e){const t=dom.slideTrack.querySelector(`[data-index="${e}"]`);if(t){t.classList.remove("video-background","active"),e<state.currentSlideIndex?t.classList.add("prev"):e>state.currentSlideIndex&&t.classList.add("next");const s=t.querySelector("video");s&&(s.pause(),s.currentTime=0)}}function flashEdge(e){const t="next"===e?dom.edgeFlashRight:dom.edgeFlashLeft;t.classList.remove("flash"),t.offsetWidth,t.classList.add("flash")}function setMode(e){if(e===state.mode)return;if("all"!==e&&"personalized"!==e)return;state.mode=e,saveMode(),clearBundleStack();const t=state.visibleSlides[state.currentSlideIndex]?.globalIndex;if(updateVisibleSlides(),void 0!==t&&state.visibleSlides.length>0){let e=state.visibleSlides.findIndex(e=>e.globalIndex===t);-1===e&&(e=state.visibleSlides.findIndex(e=>e.globalIndex>t),-1===e&&(e=state.visibleSlides.length-1)),state.currentSlideIndex=Math.max(0,e)}renderSlides(),updateUI()}function toggleMode(){setMode("all"===state.mode?"personalized":"all")}function updateUI(){updateTabBadges(),updateActiveTab(),updateModeToggle(),updateProgress(),updateSlideCounter(),updateTagChipPresentState()}function updateTabBadges(){const e={};state.visibleSlides.forEach(t=>{const s=t.sectionKey;e[s]=(e[s]||0)+1}),dom.tabs.forEach(t=>{const s=t.dataset.section;t.querySelector(".tab-badge").textContent=e[s]||0})}function updateActiveTab(){const e=state.visibleSlides[state.currentSlideIndex];e&&dom.tabs.forEach(t=>{t.classList.toggle("active",t.dataset.section===e.sectionKey)})}function updateModeToggle(){dom.modeAllBtn&&dom.modePersonalizedBtn&&(dom.modeAllBtn.classList.toggle("active","all"===state.mode),dom.modePersonalizedBtn.classList.toggle("active","personalized"===state.mode))}function updateProgress(){if(0===state.visibleSlides.length)return void(dom.progressFill.style.width="0%");const e=(state.currentSlideIndex+1)/state.visibleSlides.length*100;dom.progressFill.style.width=`${e}%`}function updateSlideCounter(){const e=state.currentSlideIndex+1,t=state.visibleSlides.length;dom.currentSlideCounter.textContent=e,dom.totalSlidesCounter.textContent=t}function showTabBar(e=!1){if(clearTimeout(state.tabBarTimeout),dom.tabBar.classList.remove("collapsed"),state.tabBarHovered||state.tagPanelVisible?dom.tabBar.classList.remove("dimmed"):dom.tabBar.classList.toggle("dimmed",e),state.tabBarVisible=!0,!state.tabBarHovered&&!state.tagPanelVisible){const t=e?CONFIG.tabBarDimmedDuration:CONFIG.tabBarAutoHideDelay;state.tabBarTimeout=setTimeout(()=>{state.tabBarHovered||state.tagPanelVisible||hideTabBar()},t)}}function hideTabBar(){state.tabBarHovered||state.tagPanelVisible||(dom.tabBar.classList.add("collapsed"),dom.tabBar.classList.remove("dimmed"),state.tabBarVisible=!1)}function toggleTabBar(){state.tabBarVisible?hideTabBar():showTabBar()}function handleTabBarMouseEnter(){state.tabBarHovered=!0,clearTimeout(state.tabBarTimeout),dom.tabBar.classList.remove("dimmed")}function handleTabBarMouseLeave(){state.tabBarHovered=!1,state.tagPanelVisible||(dom.tabBar.classList.add("dimmed"),state.tabBarTimeout=setTimeout(()=>{hideTabBar()},CONFIG.tabBarDimmedDuration))}function bindEvents(){document.addEventListener("keydown",handleKeydown),dom.slideContainer.addEventListener("touchstart",handleTouchStart,{passive:!0}),dom.slideContainer.addEventListener("touchend",handleTouchEnd,{passive:!0}),dom.navPrev.addEventListener("click",()=>navigateHorizontal("prev")),dom.navNext.addEventListener("click",()=>navigateHorizontal("next")),dom.topTrigger.addEventListener("mouseenter",()=>showTabBar()),dom.topTrigger.addEventListener("click",()=>showTabBar()),dom.tabs.forEach(e=>{e.addEventListener("click",()=>{goToSection(e.dataset.section),e.blur()})}),dom.filterButton&&dom.filterButton.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),toggleTagPanel()}),dom.modeAllBtn&&dom.modeAllBtn.addEventListener("click",e=>{e.preventDefault(),setMode("all")}),dom.modePersonalizedBtn&&dom.modePersonalizedBtn.addEventListener("click",e=>{e.preventDefault(),setMode("personalized")}),document.addEventListener("click",e=>{if(state.tagPanelVisible){const t=dom.tagPanel.contains(e.target),s=dom.filterButton.contains(e.target),a=dom.tabBar.contains(e.target);t||s||a||closeTagPanel()}}),dom.tabBar.addEventListener("mouseenter",handleTabBarMouseEnter),dom.tabBar.addEventListener("mouseleave",handleTabBarMouseLeave)}function handleKeydown(e){switch(e.key){case"ArrowRight":navigateHorizontal("next");break;case"ArrowLeft":navigateHorizontal("prev");break;case"ArrowDown":navigateVertical("next");break;case"ArrowUp":navigateVertical("prev");break;case"m":toggleMode();break;case"f":toggleTagPanel();break;case"h":showOnboarding();break;case"Escape":state.tagPanelVisible?closeTagPanel():hideTabBar()}}function handleTouchStart(e){state.touchStartX=e.touches[0].clientX,state.touchStartY=e.touches[0].clientY,state.touchStartTime=Date.now()}function handleTouchEnd(e){const t=e.changedTouches[0].clientX-state.touchStartX,s=e.changedTouches[0].clientY-state.touchStartY;if(Date.now()-state.touchStartTime>300)return;const a=Math.abs(t),n=Math.abs(s);if(a>n&&a>50)navigateHorizontal(t>0?"prev":"next");else if(n>a&&n>50)navigateVertical(s>0?"prev":"next");else if(a<10&&n<10){e.changedTouches[0].clientY<60&&toggleTabBar()}}function handleInitialState(){localStorage.getItem(CONFIG.storageKeys.onboarded)?setTimeout(()=>{showTabBar(!0)},500):(showOnboarding(),localStorage.setItem(CONFIG.storageKeys.onboarded,"true"))}function showOnboarding(){dom.onboarding.classList.remove("hidden"),setTimeout(()=>{dom.onboarding.classList.add("fading-out"),setTimeout(()=>{dom.onboarding.classList.add("hidden"),dom.onboarding.classList.remove("fading-out"),showTabBar(!0)},500)},CONFIG.onboardingDuration)}function hideLoading(){dom.loadingState.classList.add("hidden")}function showError(e){dom.loadingState.classList.add("hidden"),dom.errorState.classList.remove("hidden"),dom.errorState.querySelector(".error-message").textContent=e}window.getSlideState=()=>({allTags:Array.from(state.allTags),newTags:Array.from(state.newTags),selectedTags:Array.from(state.selectedTags),mode:state.mode,slidesCount:state.allSlides.length,firstSlideAsset:state.allSlides[0]?.asset,newsletter:state.newsletter}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",init):init();